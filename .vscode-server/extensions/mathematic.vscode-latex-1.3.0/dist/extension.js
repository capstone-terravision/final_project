(()=>{"use strict";var e={78:function(e,t){var n,i,r=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0,t.Cache=class{constructor(){n.set(this,{}),i.set(this,{})}set(e,t){r(this,n,"f")[e]=t;const o=r(this,i,"f")[e];o&&clearTimeout(o),r(this,i,"f")[e]=setTimeout((()=>{delete r(this,n,"f")[e]}),864e5)}unset(e){delete r(this,n,"f")[e];const t=r(this,i,"f")[e];t&&clearTimeout(t)}get(e){return r(this,n,"f")[e]}},n=new WeakMap,i=new WeakMap},599:function(e,t,n){var i,r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)},s=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(n){t[n]=e[n]&&function(t){return new Promise((function(i,r){!function(e,t,n,i){Promise.resolve(i).then((function(t){e({value:t,done:n})}),t)}(i,r,(t=e[n](t)).done,t.value)}))}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigResolver=void 0;const a=n(147),c=n(292),u=n(17),l=n(496),f=n(78),d=n(593);t.ConfigResolver=class{constructor(e,t){this.configKey=e,this.possibleNames=t,i.set(this,new f.Cache)}findConfig(e){return r(this,void 0,void 0,(function*(){let t=(0,d.getConfig)(this.configKey);if(!t)return yield this.resolveConfig(e);if(!(0,u.isAbsolute)(t)){const n=l.workspace.getWorkspaceFolder(e.uri);return n?(0,u.join)(n.uri.fsPath,t):(0,u.join)((0,u.dirname)(e.uri.fsPath),t)}return t}))}resolveConfig(e){var t,n,l,f;return r(this,void 0,void 0,(function*(){let r,d,h=o(this,i,"f").get("config");if(h&&(0,a.existsSync)(h))return h;for(let i=(0,u.parse)(e.uri.fsPath),o=0;i.root!==i.dir||o>100;i=(0,u.parse)(i.dir),o++){r=yield(0,c.opendir)(i.dir);try{for(var p,w=!0,v=(n=void 0,s(r));p=yield v.next(),!(t=p.done);w=!0){f=p.value,w=!1;const e=f;if(e.isFile()){const t=this.possibleNames.indexOf(e.name);t>-1&&t<(d||this.possibleNames.length)&&(d=t,h=(0,u.join)(i.dir,e.name))}}}catch(e){n={error:e}}finally{try{w||t||!(l=v.return)||(yield l.call(v))}finally{if(n)throw n.error}}if(h)break}return o(this,i,"f").set("config",h),h}))}},i=new WeakMap},285:function(e,t,n){var i,r=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.ExecutableResolver=void 0;const o=n(81),s=n(37),a=n(17),c=n(496),u=n(78),l=n(593);t.ExecutableResolver=class{static findExecutableInPath(e){var t;let n=(0,a.normalize)(e);if((0,a.isAbsolute)(n)){if(!(0,l.isExecutable)(n))return}else{let e=!1;for(const i of null!==(t=c.workspace.workspaceFolders)&&void 0!==t?t:[])if(n=(0,a.join)(i.uri.fsPath,n),(0,l.isExecutable)(n)){e=!0;break}if(!e)return}}constructor(e,t,n=new Set){this.name=e,this.extensions=t,this.paths=n,i.set(this,new u.Cache)}findExecutable(){return this.resolveExecutable(this.name)}resolveExecutable(e){let t,n=r(this,i,"f").get("exec");if(n&&(0,l.isExecutable)(n))return n;t="win32"===(0,s.platform)()?"where":"which";for(const s of[...this.extensions,""]){const c=`${e}${s}`;for(const e of this.paths)if(n=(0,a.join)(e,c).trim(),(0,l.isExecutable)(n))return r(this,i,"f").set("exec",n),n;const{status:u,stdout:f}=(0,o.spawnSync)(t,[c],{encoding:"utf-8"});if(0===u&&(n=f.trim(),(0,l.isExecutable)(n)))return r(this,i,"f").set("exec",n),n}}},i=new WeakMap},23:function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},a=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.LaTeXDocumentFormatter=void 0;const c=n(81),u=n(37),l=n(17),f=n(496),d=n(599),h=n(285),p=n(593),w=new f.Range(0,0,Number.MAX_VALUE,Number.MAX_VALUE),v=["YAML::Tiny","File::HomeDir","Unicode::GCString"];class m{constructor(){i.set(this,void 0),r.set(this,void 0),s(this,i,new d.ConfigResolver(m.CONFIG,m.CONFIG_NAMES),"f");let e=new Set;try{const{stdout:t}=(0,c.spawnSync)("kpsewhich",["--var-value","TEXMFDIST"],{encoding:"utf-8"});e.add((0,l.join)((0,l.normalize)(t.trim()),"scripts","latexindent"))}catch(e){}s(this,r,new h.ExecutableResolver(m.EXECUTABLE,new Set("win32"===(0,u.platform)()?[".exe",".pl"]:[".pl"]),e),"f")}provideDocumentFormattingEdits(e,t){var n;return o(this,void 0,void 0,(function*(){let o=(0,p.getConfig)("formatter.path");if(o){let e=h.ExecutableResolver.findExecutableInPath(o);if(!e)return yield f.window.showErrorMessage(`Specified path ${o} could not be found${(0,l.isAbsolute)(o)?" in any opened workspace folder":""}.`),[];o=e}else if(o=a(this,r,"f").findExecutable(),!o)return yield f.window.showErrorMessage(`${m.EXECUTABLE} could not be found.`),[];const s=yield a(this,i,"f").findConfig(e),{output:u,error:d}=this.execute(e,o,t,s);if(d){if(d.message.includes("Can't locate")){if(yield f.window.showErrorMessage(d.message,{title:"Install dependencies"}))for(const e of v){const{stdout:t,stderr:i,error:r,status:o}=(0,c.spawnSync)("cpanm",[e],{encoding:"utf-8",input:"yes\n"}),s=((null!==(n=null==r?void 0:r.message)&&void 0!==n?n:i)||t).trim();if(0!==o){yield f.window.showErrorMessage(`Could not install ${e}: ${s}`);break}}}else yield f.window.showErrorMessage(d.message);return[]}return u?[f.TextEdit.replace(e.validateRange(w),u)]:[]}))}execute(e,t,n,i){const r=["-g","/dev/null","-m"];if(i)r.push("-l",i);else{const e={defaultIndent:Array(n.insertSpaces?n.tabSize:1).fill(n.insertSpaces?" ":"\t").join(""),textWrapOptions:{columns:(0,p.getConfig)("formatter.columnLimit")}};r.push("-y",`defaultIndent:'${e.defaultIndent}',modifyLineBreaks:textWrapOptions:columns:${e.textWrapOptions.columns}`)}r.push("-");const{stdout:o,stderr:s,error:a}=(0,c.spawnSync)(t,r,{encoding:"utf-8",input:e.getText(),timeout:(0,p.getConfig)("formatter.timeout")});return{output:o,error:null!=a?a:s&&new Error(s)}}}t.LaTeXDocumentFormatter=m,i=new WeakMap,r=new WeakMap,m.EXECUTABLE="latexindent",m.CONFIG="linter.config",m.CONFIG_NAMES=["localSettings.yaml","latexindent.yaml",".localSettings.yaml",".latexindent.yaml"]},459:function(e,t,n){var i,r,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))},s=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},a=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.LaTeXDocumentLinter=void 0;const c=n(81),u=n(37),l=n(17),f=n(496),d=n(599),h=n(285),p=n(593),w={Error:f.DiagnosticSeverity.Error,Warning:f.DiagnosticSeverity.Warning,Message:f.DiagnosticSeverity.Information};class v{constructor(){i.set(this,void 0),r.set(this,void 0),s(this,i,new d.ConfigResolver(v.CONFIG,v.CONFIG_NAMES),"f"),s(this,r,new h.ExecutableResolver(v.EXECUTABLE,new Set("win32"===(0,u.platform)()?[".exe"]:[])),"f")}provideDocumentLintingDiagnostics(e){return o(this,void 0,void 0,(function*(){let t=(0,p.getConfig)("linter.path");if(t){let e=h.ExecutableResolver.findExecutableInPath(t);if(!e)return yield f.window.showErrorMessage(`Specified path ${t} could not be found${(0,l.isAbsolute)(t)?" in any opened workspace folder":""}.`),[];t=e}else if(t=a(this,r,"f").findExecutable(),!t)return yield f.window.showErrorMessage(`${v.EXECUTABLE} could not be found.`),[];const n=yield a(this,i,"f").findConfig(e),{output:o,error:s}=this.execute(e,t,n);return s?(yield f.window.showErrorMessage(s.message),[]):o?this.parseLintOutput(e,o):[]}))}execute(e,t,n){const i=[];n&&i.push("-l",n),i.push("-f","%k:%n:%l:%c:%d:%m\n"),i.push("-q"),i.push("-I");const{stdout:r,stderr:o,error:s}=(0,c.spawnSync)(t,i,{encoding:"utf-8",input:e.getText(),timeout:(0,p.getConfig)("linter.timeout")});return{output:r,error:null!=s?s:o&&new Error(o)}}parseLintOutput(e,t){const n=[];for(const i of t.trim().split("\n")){const[t,r,o,s,a,c]=i.split(":",6),u=new f.Position(+o-1,+s-1),l=e.positionAt(e.offsetAt(u)+ +a);n.push(new f.Diagnostic(new f.Range(u,l),`[${v.EXECUTABLE}] ${r}: ${c}`,w[t]))}return n}}t.LaTeXDocumentLinter=v,i=new WeakMap,r=new WeakMap,v.EXECUTABLE="chktex",v.CONFIG="linter.config",v.CONFIG_NAMES=[".chktexrc","chktexrc"]},580:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.registerDocumentLintingProvider=void 0;const r=n(496),o=n(593);t.registerDocumentLintingProvider=function(e,t){const n=e=>i(this,void 0,void 0,(function*(){const n=[];for(const i of t)n.push(...yield i.provideDocumentLintingDiagnostics(e));l.set(e.uri,n)}));let s;const a=(t,i)=>{if((0,o.getConfig)("linter.enabled")&&r.languages.match(e,t)){if(i)return n(t);s&&clearTimeout(s),s=setTimeout((()=>n(t)),(0,o.getConfig)("linter.delay"))}};let c=r.window.activeTextEditor;c&&a(c.document,!0);const u=[],l=r.languages.createDiagnosticCollection("latex");return u.push(l),r.window.onDidChangeActiveTextEditor((t=>{c=t,t&&r.languages.match(e,t.document)&&(s&&clearTimeout(s),a(t.document))}),void 0,u),r.workspace.onDidChangeTextDocument((({document:e})=>{c&&e===c.document&&a(e)}),void 0,u),{dispose(){u.forEach((e=>e.dispose()))}}}},593:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isExecutable=t.getConfig=void 0;const i=n(57),r=n(147),o=n(496);t.getConfig=function(e){return o.workspace.getConfiguration("latex").get(e)},t.isExecutable=function(e){try{return(0,r.accessSync)(e,i.X_OK),!0}catch(e){return!1}}},496:e=>{e.exports=require("vscode")},81:e=>{e.exports=require("child_process")},57:e=>{e.exports=require("constants")},147:e=>{e.exports=require("fs")},292:e=>{e.exports=require("fs/promises")},37:e=>{e.exports=require("os")},17:e=>{e.exports=require("path")}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}var i={};(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=n(496),r=n(23),o=n(459),s=n(580),a={scheme:"file",language:"latex"};e.activate=function(e){e.subscriptions.push(t.languages.registerDocumentFormattingEditProvider(a,new r.LaTeXDocumentFormatter)),e.subscriptions.push((0,s.registerDocumentLintingProvider)(a,[new o.LaTeXDocumentLinter]))},e.deactivate=function(){}})(),module.exports=i})();